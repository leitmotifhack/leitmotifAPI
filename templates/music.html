<head>
  <title>p5.Gibber.js - mouse/bass example</title>
  <script src="{{ url_for('static', filename='p5.min.js') }}"></script>
  <script src="{{ url_for('static', filename='p5.gibber.js') }}"></script>
  <script src="{{ url_for('static', filename='p5.sound.min.js') }}"></script>
</head>
<style>
body {
  padding:0;
  margin:0;
}
</style>
<script>
var xspacing = 16;    // Distance between each horizontal location
var w;                // Width of entire wave
var theta = 0.0;      // Start angle at 0
var amplitude = 75.0; // Height of wave
var period = 500.0;   // How many pixels before the wave repeats
var dx;               // Value for incrementing x
var yvalues;  // Using an array to store height values for the wave
var prior_curr = 30; // default val
var sine_wave = []  // This will be a evolving sine wave
var inv_yvalues


function setup() {
  createCanvas( windowWidth, windowHeight );
  w = width+16;
  dx = (TWO_PI / period) * xspacing;
  yvalues = new Array();
  inv_yvalues = new Array();
  MAX_ARR_SIZE = floor(w/xspacing)

  drums = EDrums( 'x*o*x*o-' )
  drums.amp = .5

  sampler = Sampler().record( drums, 1 )
  .note.seq( [1,2], [1/4,1/8,1/2].rnd() )
  .fx.add( Delay(1/64))
  .pan.seq( Rndf(-1,1) )

  rhodes = Synth( 'rhodes', {amp:.1} )
    .chord.seq( Rndi(0,6,3), 1 )
    .fx.add( Delay() )
  
  Gibber.scale.root.seq( ['c4','eb4'], 1 );
}

function draw() {
  background(0);
  calcWave();
  renderWave();
}

function calcWave() {
  // Increment theta (try different values for 
  // 'angular velocity' here)
  theta += 0.02;

  // For every x value, calculate a y value with sine function
  var x = theta;

  // Append value to wave up to a limit
  var amplitude = sampler.pitch * 30;
  curr_val = sin(x)*100;
  weighted_val = (0.7 * prior_curr) + (0.3 * curr_val)

  if (yvalues.length <= MAX_ARR_SIZE) {
    yvalues.push(curr_val)
    inv_yvalues.push(-1 * curr_val);
  } else {
    yvalues.push(curr_val);
    inv_yvalues.push(-1 * curr_val);
    yvalues.splice(0, 1);
    inv_yvalues.splice(0, 1);
  }

  prior_curr = curr_val;
}

function renderWave() {
  noStroke();
  fill(255);
  // A simple way to draw the wave with an ellipse at each location
  for (var x = 0; x < yvalues.length; x++) {
    var forward_strand_h = height/2+yvalues[x];
    var reverse_strand_h = height/2+inv_yvalues[x]
    ellipse(x*xspacing, forward_strand_h, 16, 16);
    ellipse(x*xspacing, reverse_strand_h, 16, 16);
    //Draw line: https://p5js.org/examples/form-points-and-lines.html
    line(forward_strand_h, reverse_strand_h, forward_strand_h, reverse_strand_h);
  }
}

</script>
<body></body>
